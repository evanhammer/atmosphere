/*
 * wallaby-vscode - v1.0.74
 * http://wallabyjs.com
 * Copyright (c) 2014-2018 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of wallaby-vscode and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}process.env.WALLABY_PRODUCTION=!0;var f="function"==typeof require&&require;module.exports=e(d[0])}({1:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("fs"),g=a("path"),h=a("os"),i=a("vscode"),j=a("./lib/compositeDisposable"),k=i.window,l=i.workspace,m=h.tmpdir(),n=/^win/.test(process.platform),o=/^darwin/.test(process.platform),p=6e5,q="2.1.1",r=a("./package.json").version,s=void 0,t=void 0,u="https",v=void 0,w=function(){function b(){d(this,b)}return e(b,[{key:"activate",value:function(c){var d=this;d._disposables=new j,d._disposables.add(function(){delete d._failedUpdateCount,clearTimeout(d._updateChecker)}),setImmediate(function(){s=a("q"),t=a("lockfile");try{i.workspace.getConfiguration()&&(i.workspace.getConfiguration().get("wallaby.useHttpForDownload",!1)&&(u="http"),i.workspace.getConfiguration().get("wallaby.strictSSL",!0)||(v=!1))}catch(e){}d._baseUrl=u+"://update.wallabyjs.com/",d._versionFile=g.join(__dirname,"wallaby.json"),d._updateLockFile=g.join(__dirname,"update.lock"),d._updateLockOpts={stale:p},d._corePackage=g.join(__dirname,"..","wallaby","package.json"),d._coreFolder=g.dirname(d._corePackage),d._phantomFolder=g.join(c.extensionPath,"..","..","phantomjs_v"+q),d._phantomBinary=g.join(d._phantomFolder,"phantomjs"+(n?".exe":"")),d._lkp=g.join(f.realpathSync(c.extensionPath),"..",".wlck"),(b._isDebugMode()||b._noAutomaticInstallMode())&&(b._download=function(){throw new Error("Can not delete/download/extract in this mode")}),d._setupStatusIndicator(),d._updateIfRequired(!0,void 0,b._expiryDate(d._lkp)).then(function(e){var f=e[1],g=a("../wallaby/client"),h={context:c,coreClient:g,statusBar:d._statusBar,phantomPath:d._phantomBinary,onFirstStart:function(){clearTimeout(d._updateChecker),d._updateChecker=setTimeout(function(){return d._performUpdate(h)},p)},updateAvailable:function(){},debug:b._isDebugMode(),licensed:!1,isMac:o,firstInstall:f,deactivate:function(){return d.deactivate()},version:b._getVersion()},i=a("./lib/controller");d._controller=new i(h),d._controller.activate(),d._disposables.add(function(){return d._controller.deactivate()}),console.log("[Wallaby Console] VS Code extension v"+r),console.log("[Wallaby Console] Core v"+b._requireNoCache(d._corePackage).version)}).fail(function(a){return b._notifyError(a.message)})["finally"](function(){return d._hideStatusIndicator()})})}},{key:"_performUpdate",value:function(a){var c=this;return c._updateIfRequired(!1,a.licensed,b._expiryDate(c._lkp)).then(function(d){var e=d[0];e&&(global._wallabyNewCore=e),e&&a.updateAvailable(function(){var a=[],d=global._wallabyNewCore;delete global._wallabyNewCore,d&&f.existsSync(d)&&(c._suppressUpdateNotifications||k.showInformationMessage("Updating wallaby.js core. It may take a few seconds, you will be notified once the update is finished."),a.push(b._extract(d,c._coreFolder))),s.all(a).then(function(){global._wallabyHasJustUpdated=!0,delete c._failedUpdateCount,c._suppressUpdateNotifications||k.showInformationMessage("Wallaby.js core has been successfully updated to v"+b._requireNoCache(c._corePackage).version+".")}).fail(function(a){return b._notifyError(a.message)})})}).fail(function(a){c._failedUpdateCount=c._failedUpdateCount?c._failedUpdateCount+1:1,console.error(a)})["finally"](function(){c._failedUpdateCount&&c._failedUpdateCount>3||(c._updateChecker=setTimeout(function(){return c._performUpdate(a)},p))})}},{key:"_updateIfRequired",value:function(a,c,d){var e=this,f=global._wallabyHasJustUpdated,h=e._baseUrl;delete global._wallabyHasJustUpdated;var i=function(a){return b._download({name:"version",from:a+"wallaby.json?licensed="+(c&&"true"||"false")+(d?"&expiry="+d.replace(/\//g,"-"):""),to:e._versionFile})};return s.all([f?s.when({}):b._stat(e._corePackage),f?s.when({}):b._stat(e._phantomBinary)]).then(function(c){var d=c[0],g=c[1];return s.all([d,g,b._isDebugMode()||b._noAutomaticInstallMode()||f||a&&d&&g?s.when({core:d&&b._requireNoCache(e._corePackage).version||"unknown"}):(e._statusUpdater("Downloading wallaby.js version file"),i(e._baseUrl).fail(function(){return h=u+"://s3.amazonaws.com/wallaby-downloads/",i("http://update.wallabyjs.com/")}).then(function(){return e._version()}))])}).then(function(c){var d=c[0],f=c[1],i=c[2],j=[s.when(!1),s.when(!1)];if(t.checkSync(e._updateLockFile,e._updateLockOpts))return s.all(j);var l=!0,m=!1;if(b._noAutomaticInstallMode()&&(!d||!f))throw new Error("With wallaby.noAutomaticInstall option set, you need to manually install wallaby core and dependencies when the extension is installed/updated.");return d&&b._requireNoCache(e._corePackage).version===i.core||(j[0]=b._download({name:"core",from:h+"wallaby-v"+i.core+".zip",to:e._coreFolder,unzip:a}).fail(function(){return b._download({name:"core",from:u+"://s3.amazonaws.com/wallaby-downloads/wallaby-v"+i.core+".zip",to:e._coreFolder,unzip:a})}),e._statusUpdater("Downloading and extracting wallaby.js core"),l=!1),f||(j[1]=b._download({name:"phantom.js",from:u+"://s3.amazonaws.com/wallaby-downloads/phantom/phantomjs-"+q+"-"+(n?"windows.zip":o?"macosx.zip":"linux-"+("x64"===process.arch?"x86_64.tar.bz2":"i686.tar.bz2")),to:e._phantomFolder,makeExecutable:!n,entryName:g.basename(e._phantomBinary),unzip:a}),e._statusUpdater("Downloading and extracting wallaby.js dependencies"),l=!1,m=!0),l||t.lockSync(e._updateLockFile,e._updateLockOpts),a&&!l&&(m?k.showInformationMessage("Installing wallaby.js dependencies. It may take a minute or two, you will be notified once the install is finished."):e._suppressUpdateNotifications||k.showInformationMessage("Updating wallaby.js core. It may take a few seconds, you will be notified once the update is finished.")),s.all(j).then(function(b){return l||t.unlockSync(e._updateLockFile),a&&!l&&(m?k.showInformationMessage("Wallaby.js dependencies and core v"+i.core+" have been successfully installed."):e._suppressUpdateNotifications||k.showInformationMessage("Wallaby.js core v"+i.core+" has been successfully installed.")),s.when(b)})})}},{key:"_version",value:function(){var a=b._requireNoCache(this._versionFile),c=void 0;return a.latestServer.forEach(function(a){a.substring(0,a.lastIndexOf("."))===r.substring(0,a.lastIndexOf("."))&&(c=a)}),{core:c}}},{key:"_setupStatusIndicator",value:function(){var a=this;a._statusBar=k.createStatusBarItem(i.StatusBarAlignment.Right,Number.NEGATIVE_INFINITY),a._statusBar.show();var b=a._statusBar.hide.bind(a._statusBar),c=a._statusBar.dispose.bind(a._statusBar);a._statusBar.hide=function(){a._statusBar.stopProgress(),b()},a._statusBar.dispose=function(){a._statusBar.stopProgress(),c()},a._statusBar.displayProgress=function(){var b=0,c=["[=--------]","[-=-------]","[--=------]","[---=-----]","[----=----]","[-----=---]","[------=--]","[-------=-]","[--------=]","[-------=-]","[------=--]","[-----=---]","[----=----]","[---=-----]","[--=------]","[-=-------]"];clearInterval(a._statusBar._progress),a._statusBar._progress=setInterval(function(){a._statusBar.setMainText(c[b=++b%c.length]+"   "),a._statusBar._doUpdateText()},150)},a._statusBar.setMainText=function(b){a._statusBar._mainText=b},a._statusBar.setExtensionText=function(b){a._statusBar._extensionText=b},a._statusBar.updateText=function(){return a._statusBar._doUpdateText()},a._statusBar._doUpdateText=function(){a._statusBar.text=(a._statusBar._mainText||"")+" "+(a._statusBar._extensionText||"")},a._statusBar.stopProgress=function(){clearInterval(a._statusBar._progress),delete a._statusBar._progress},a._statusBar.displayProgress(),a._statusUpdater=function(b){a._statusBar.tooltip=b},a._disposables.add(function(){a._removeStatusIndicator()})}},{key:"_hideStatusIndicator",value:function(){this._statusBar&&(this._statusBar.text="",this._statusBar.tooltip="",this._statusBar.hide()),this._statusUpdater=function(){}}},{key:"_removeStatusIndicator",value:function(){this._statusBar&&this._statusBar.dispose(),this._statusUpdater=function(){}}},{key:"deactivate",value:function(){this._disposed||(this._disposables.dispose(),this._disposed=!0)}},{key:"suppressUpdateNotifications",value:function(){this._suppressUpdateNotifications=!0}}],[{key:"_isDebugMode",value:function(){return l.getConfiguration()&&l.getConfiguration().get("wallaby.debug",!1)}},{key:"_noAutomaticInstallMode",value:function(){return l.getConfiguration()&&l.getConfiguration().get("wallaby.noAutomaticInstall",!1)}},{key:"_requireNoCache",value:function(a){return delete originalRequire.cache[originalRequire.resolve(a)],originalRequire(a)}},{key:"_stat",value:function(a){return s.nfcall(f.stat,a).fail(function(){return!1})}},{key:"_remove",value:function(c,d,e){return(d?s.nfcall(a("fs-extra").remove,c):s.nfcall(f.unlink,c)).fail(function(a){if(e)throw a;return b._remove(c,d,!0)})}},{key:"_download",value:function(c){return s.promise(function(d,e){var h=a("request"),j=g.extname(c.from),k=".zip"===j||".bz2"===j?g.join(m,g.basename(c.to)+j):c.to;try{h({url:c.from,headers:{"User-Agent":"VS Code "+i.version},strictSSL:v}).on("error",function(a){return e(new Error("Error while downloading wallaby.js "+c.name+" file: "+a.message))}).pipe(f.createWriteStream(k)).on("error",function(a){return e(new Error("Error while saving wallaby.js "+c.name+" file: "+a.message))}).on("close",function(){c.unzip?b._extract(k,c.to,c.entryName,c.makeExecutable).then(function(){return d(k)}).fail(function(a){return e(new Error("Error while unzipping wallaby.js "+c.name+" file: "+a.message))}):d(k)})}catch(l){e(l)}})}},{key:"_extract",value:function(c,d,e,h){return b._remove(d,!0).then(function(){try{if(~c.indexOf(".bz2"))return s.nfcall(a("fs-extra").ensureDir,d).then(function(){return s.promise(function(b,h){try{var i=a("unbzip2-stream"),j=a("tar-stream").extract();f.createReadStream(c).pipe(i()).pipe(j).on("entry",function(a,b,c){try{"phantomjs"===g.basename(a.name)?(b.pipe(f.createWriteStream(g.join(d,e))).on("finish",c).on("error",h),b.resume()):c()}catch(i){h(i)}}).on("finish",b)}catch(k){h(k)}})});var b=a("adm-zip-mit"),h=new b(c);if(e){var i=h.getEntries().find(function(a){return!a.isDirectory&&a.name===e});if(!i)throw new Error("Can not find "+e+" in the archive");h.extractEntryTo(i.entryName,d,!1,!0)}else h.extractAllTo(d,!0)}catch(j){throw"string"==typeof j?new Error(j):j}return s.when(!0)}).then(function(){return h&&f.chmodSync(g.join(d,e),"0755"),s.when(!0)})}},{key:"_notifyError",value:function(a){k.showErrorMessage(a)}},{key:"_expiryDate",value:function(b){try{return new Buffer(a("fs").readFileSync(b).toString(),"base64").toString().split("\n")[2]}catch(c){}}},{key:"_getVersion",value:function(){var a=1,b=0;try{var c=i.version.split(".");a=parseInt(c[0],10),b=parseInt(c[1],10)}catch(d){}return{major:a,minor:b}}}]),b}();c.activate=function(a){var b=new w;a.subscriptions.push({dispose:function(){return b.deactivate()}});var c=w._getVersion();c.major<=1&&c.minor<18&&!function(){var a=process.exit,c=function(){b.deactivate(),a.apply(process,arguments)},d=process.exit=function(){c.apply(null,arguments)};process.on("SIGINT",function(){d.apply(null,arguments)}),process.on("SIGTERM",function(){d.apply(null,arguments)}),process.on("exit",function(){d.apply(null,arguments)})}();try{var d=i.workspace.getConfiguration();if(d){var e=d.get("http.proxy","");e&&(process.env.http_proxy=e),d.get("wallaby.showUpdateNotifications",!0)||b.suppressUpdateNotifications()}}catch(h){}try{var d=i.workspace.getConfiguration();d&&!function(){var b=d.get("wallaby.colors",{});b&&Object.keys(b).forEach(function(c){try{if(!c)return;var d=a.asAbsolutePath(g.join("images",c+".svg"));if(!f.existsSync(d))return;var e=f.readFileSync(d).toString().replace(/fill:#.[^;]*/,"fill:"+b[c]);f.writeFileSync(d,e)}catch(h){console.error("Failed to set icon "+c+" type to "+b[c]+". "+h.message)}})}()}catch(h){}b.activate(a)}},{"./lib/compositeDisposable":3,"./lib/controller":4,"./package.json":7,"adm-zip-mit":void 0,fs:void 0,"fs-extra":void 0,lockfile:void 0,os:void 0,path:void 0,q:void 0,request:void 0,"tar-stream":void 0,"unbzip2-stream":void 0,vscode:void 0}],2:[function(a,b,c){"use strict";var d=a("vscode"),e=a("path");c.activate=function(b){var c=d.workspace.getConfiguration()&&d.workspace.getConfiguration().get("wallaby.debug",!1);return c&&(global.originalRequire=a),c||"dist"===e.basename(__dirname)?a("./extension").activate(b):(global.originalRequire=a,a("./dist/index").activate(b))}},{"./extension":1,path:void 0,vscode:void 0}],3:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this._disposables=[]}return e(a,[{key:"add",value:function(a){a.dispose?this._disposables.push(a):this._disposables.push({dispose:a})}},{key:"dispose",value:function(){this._disposables.forEach(function(a){return a.dispose()})}}]),a}();b.exports=f},{}],4:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0,h=j=void 0}},i=a("path"),j=a("crypto"),k=a("fs-extra"),l=a("vscode"),m=a("./compositeDisposable"),n=a("./screenshotContentProvider"),o=a("./testsOutputBuilder"),p=l.workspace,q=l.window,r=300,s="wallaby.showCommandPalette",t=["start","stop","showCommandPalette","showLastScreenshot","showLicense","runProjectTests","runLineTests","runFileTests","updateProjectSnapshots","updateFileSnapshots","updateTestSnapshots","jumpToFailingTest","jumpToErrorSource","toggleUncovered","showLineTests","selectConfigFile","showFailingTests","showSideBySideDiff","openWallabyApp"],u=function(b){function c(a){e(this,c),h(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var b=this;this._state=a,this._context=a.context,this._phantomPath=a.phantomPath,this._statusBar=a.statusBar,this._Session=a.coreClient.Session,this._utils=a.coreClient.utils,this._isMac=a.isMac,this._firstInstall=a.firstInstall,this._deactivator=a.deactivate,this._lineAndColumnLinks=!1,a.updateAvailable=_.bind(this._updateAvailable,this),this._disposables=new m,_.each(t,function(a){return b._disposables.add(l.commands.registerCommand("wallaby."+a,function(c){return b[a](c)}))}),this._coverageDecorationTypes={1:b._createCoverageDecorationType("notCovered"),2:b._createCoverageDecorationType("covered"),3:b._createCoverageDecorationType("partiallyCovered"),4:b._createCoverageDecorationType("errorSource"),5:b._createCoverageDecorationType("errorPath")},this._outputDocumentSelector={language:"wallaby-output"},this._setupVersionSpecificComponents(a.version),this._uncoveredRegionDecorationType=q.createTextEditorDecorationType({backgroundColor:"#d2a032",color:"#ffffff"}),this._testsOutputChannel=q.createOutputChannel("Wallaby.js Tests"),this._consoleOutputChannel=q.createOutputChannel("Wallaby.js Console");var d=_.bind(b._absoluteFilePath,b);this._failingTestsOutput=new o(this._testsOutputChannel,d,a.coreClient.dmp,this._disposables,this._lineAndColumnLinks,!0,this._outputDocumentSelector,this._sideBySideDiffSupported),this._lineTestsOutput=new o(this._testsOutputChannel,d,a.coreClient.dmp,this._disposables,this._lineAndColumnLinks,void 0,this._outputDocumentSelector,this._sideBySideDiffSupported),l.workspace.registerTextDocumentContentProvider&&(b._screenshotProvider=new n(function(){return l.Uri.file(i.join(b._session.projectCachePath,"instrumented","screen.png"))}),b._disposables.add(l.workspace.registerTextDocumentContentProvider("wallaby-screenshot",b._screenshotProvider)),b._disposables.add(l.workspace.registerTextDocumentContentProvider("wallaby-diff",{provideTextDocumentContent:function(a){return new Buffer(a.query.toString(),"base64").toString()}}))),b._disposables.add(l.languages.registerHoverProvider(["javascript","javascriptreact","typescript","typescriptreact","coffeescript"],{provideHover:function(a,c){return b._stats&&b._stats.errors?new Promise(function(d){if(!b._session)return d();var e=c.line+1;b._session.requestError({file:b._getDocumentFilePath(a),line:e,type:"errorSource"},function(a){if(!a||!a.error||!a.error.expected&&!a.error.actual)return d();var c=b._failingTestsOutput.createDiffMarkdown(a.error.expected,a.error.actual,a.error.snapshot,e);return l.MarkdownString&&(c=new l.MarkdownString(c),c.isTrusted=!0),d(new l.Hover(c))})}):void 0}}))}return f(c,b),g(c,[{key:"_setupVersionSpecificComponents",value:function(a){var b=a.major,d=a.minor;b>=1&&d>=2&&l.workspace.registerTextDocumentContentProvider&&(this._sideBySideDiffSupported=!0),b>=1&&d>=3&&(this._hideAfterContentDecorationType=q.createTextEditorDecorationType({isWholeLine:!0,after:{margin:"0 0 0 -10000px"}})),b>=1&&d>=5&&(this._lineAndColumnLinks=!0),b>=1&&d>=10&&(c._escapeInlineMessage=function(a){return a}),b>=1&&d>=11&&(this._outputDocumentSelector.scheme="*"),b>=1&&d>=16&&(this._multiFolderWorkspaces=!0)}},{key:"_createCoverageDecorationType",value:function(a){return q.createTextEditorDecorationType({isWholeLine:!0,gutterIconPath:this._context.asAbsolutePath(i.join("images",a+".svg")).split("\\").join("/"),light:{after:{color:"errorSource"===a?"#c80000":"#0000ff"}},dark:{after:{color:"errorSource"===a?"#fe536a":"rgba(86, 156, 214, 1)"}}})}},{key:"activate",value:function(){var b=this,d=this;this._onceDocumentStopsChanging=_.debounce(_.bind(this._onceDocumentStopsChanging,this),100),c._outputTestResults=_.debounce(_.bind(c._outputTestResults,this),100),this._processOpenedEditors=_.debounce(_.bind(this._processOpenedEditors,this),100),d._statusBar.updateText=_.debounce(_.bind(d._statusBar.updateText,d._statusBar),200),this._executeCommand=_.bind(this._execute,this),this._packagePath=k.realpathSync(this._context.extensionPath),this._packageMetadata=a(i.join(this._packagePath,"package.json")),this._lkp=i.join(this._packagePath,"..",".wlck"),d._commands=_.reduce(this._packageMetadata.contributes.commands,function(a,b){return b.command!==s&&(a[b.title.substr(12)]=b),a},{}),d._keyBindings=_.reduce(this._packageMetadata.contributes.keybindings,function(a,b){return a[b.command]=b,a},{}),d._firstInstall&&q.showInformationMessage("Start with displaying all wallaby.js commands using "+d._formatShortcut(d._keyBindings[s])+" shortcut."),this._statusBar.command="wallaby.showFailingTests",this._setActiveProjectRootAndConfig(),this._disposables.add(function(){d.stop(),d._statusBar&&d._statusBar.hide(),d._testsOutputChannel.dispose(),d._consoleOutputChannel.dispose(),_.each(d._coverageDecorationTypes,function(a){return a.dispose()}),d._uncoveredRegionDecorationType.dispose()}),this.on("stopped",function(){return d._removeStatus()}),this.on("busy",function(){clearTimeout(d._statusUpdateTimeout),d._statusUpdateTimeout=setTimeout(function(){return d._updateStatus("progress")},r)}),this.on("notification",function(a){var c=[];if(!~a.text.indexOf("expire")||"warning"!==a.type||!b._suppressExpirationNotifications){~a.text.indexOf("activate-link")&&c.push({title:"Activate License",command:"wallaby.showLicense"}),~a.text.indexOf("continue-trial-link")&&c.push({title:"Continue Trial",command:"_continueTrial"}),~a.text.indexOf("purchase")&&c.push({title:"Purchase License",command:"_openPurchasePage"}),a.text=a.text.replace(/<br\/><br\/>/g," ").replace(/<br\/>/g," ").replace(/<[^>]*>/g,"");var e=[a.text].concat(c);q["show"+a.type.charAt(0).toUpperCase()+a.type.substr(1)+("info"===a.type?"rmation":"")+"Message"].apply(q,e).then(d._executeCommand),0===a.text.indexOf("Can not start node.js process")&&q.showInformationMessage('You may use the "wallaby.node" setting to configure the location of node.')}}),this.on("stats",function(a){a&&(d._stats=a,c._outputTestResults(d._failingTestsOutput,a)),d._updateStatus()}),this.on("filesToTrack",function(a,c){var d=b;_.reduce(c,function(a,b){return a[b]||(a[b]={changes:[],path:b}),a},a.filesToTrack),d._processOpenedEditors(a)}),this.on("live",function(a){return d._observeDocuments(a)}),this.on("documentUpdates",function(a,b){d._updateDocuments(a,b),d._displayInlineMessageInActiveEditor(a),d._screenshotProvider&&d._screenshotProvider.update()}),this._multiFolderWorkspaces&&p.onDidChangeWorkspaceFolders&&this._disposables.add(p.onDidChangeWorkspaceFolders(function(){var a=b._activeConfig;b._setActiveProjectRootAndConfig(b._activeConfig),a!==b._activeConfig&&b.stop()}))}},{key:"_configFile",value:function(a){this._setActiveProjectRootAndConfig(a)}},{key:"_findProject",value:function(a){var b=this;if(a){if(this._multiFolderWorkspaces&&p.workspaceFolders){var c=_.find(p.workspaceFolders,function(b){return~a.indexOf(b.uri.fsPath)});if(c)return c.uri.fsPath}else if(p.rootPath&&~a.indexOf(p.rootPath))return p.rootPath}else{if(!this._multiFolderWorkspaces||!p.workspaceFolders)return p.rootPath;var d=function(){var a=b._context.workspaceState.get("wallaby:activeProjectRoot");return a&&_.find(p.workspaceFolders,function(b){return a===b.uri.fsPath})?{v:a}:p.workspaceFolders.length?{v:p.workspaceFolders[0].uri.fsPath}:void 0}();if("object"==typeof d)return d.v}}},{key:"_setActiveProjectRootAndConfig",value:function(a){a&&!k.existsSync(a)&&(a=void 0),this._activeProject=this._findProject(a)||void 0,a&&!this._activeProject&&(a=void 0,this._activeProject=this._findProject()),this._context.workspaceState.update("wallaby:activeProjectRoot",this._activeProject),this._activeProject?(a?this._activeConfig=a:(this._activeConfig=this._context.workspaceState.get("wallaby:configPath:"+c._hash(this._activeProjectRoot())),this._activeConfig&&!k.existsSync(this._activeConfig)&&delete this._activeConfig,this._activeConfig||(this._activeConfig=this._configByConvention())),this._context.workspaceState.update("wallaby:configPath:"+c._hash(this._activeProject),this._activeConfig),this._activeConfigFolder=this._activeConfig?i.dirname(this._activeConfig):void 0):(this._activeConfig=void 0,this._activeConfigFolder=void 0)}},{key:"_activeProjectRoot",value:function(){return this._activeProject}},{key:"_configPath",value:function(){return this._activeConfig}},{key:"_configFolderPath",value:function(){return this._activeConfigFolder}},{key:"deactivate",value:function(){this._disposed||(this._disposables.dispose(),this._disposed=!0)}},{key:"_forceDeactivate",value:function(){this._deactivator(),_.each(t,function(a){return l.commands.registerCommand("wallaby."+a,function(){return q.showWarningMessage("Wallaby.js trial session is over, please restart VS Code for a new trial session.")})})}},{key:"selectConfigFile",value:function(a){var b=this,c=this._activeProjectRoot(),d=this._relativeConfigPath();p.findFiles("**/*wallaby*.*","**/node_modules/**",500).then(function(e){return e&&e.length?q.showQuickPick(_.map(e,function(a){return{label:b._relativeNormalizedFilePath(a.fsPath,b._activeProjectRoot()),path:a.fsPath}}),{placeHolder:c&&d?"Currently selected: "+i.join(i.basename(c),d):void 0}).then(function(c){c&&(b._configFile(c.path),a&&a())}):void q.showWarningMessage('Can not find any file containing "wallaby" in its name.')})}},{key:"openWallabyApp",value:function(){try{var b=this._started?"http://localhost:51245":"https://wallabyjs.com/app/";a("openurl").open(b)}catch(c){}}},{key:"showFailingTests",value:function(){this._failingTestsOutput.show(),this._stats&&c._outputTestResults(this._failingTestsOutput,this._stats,!0)}},{key:"showCommandPalette",value:function(){var a=this;q.showQuickPick(_.map(a._commands,function(b,c){var d={label:c},e=a._keyBindings[b.command];return e&&(d.description=a._formatShortcut(e)),d})).then(function(b){return b&&l.commands.executeCommand(a._commands[b.label].command)})}},{key:"_formatShortcut",value:function(a){var b=this;if(a){var c=b._isMac?a.mac:a.key;return _.map(c.split(" "),function(a){return _.map(a.split("+"),function(a){var c=a.charAt(0).toUpperCase()+a.slice(1);return b._isMac&&c.replace("Cmd","⌘").replace("Ctrl","⌃").replace("Alt","⌥").replace("Shift","⇧")||c}).join(b._isMac?"":"+")}).join(" ")}}},{key:"showLastScreenshot",value:function(){this._session&&this._screenshotProvider&&l.commands.executeCommand("vscode.previewHtml",l.Uri.parse("wallaby-screenshot://authority/wallaby-screenshot"),l.ViewColumn.Two)}},{key:"runLineTests",value:function(){this._runTests("line")}},{key:"runFileTests",value:function(){this._runTests("file")}},{key:"runProjectTests",value:function(){this._runTests("project")}},{key:"updateTestSnapshots",value:function(a){this._runTests("line",a)}},{key:"updateFileSnapshots",value:function(){this._runTests("file")}},{key:"updateProjectSnapshots",value:function(){this._runTests("project")}},{key:"jumpToFailingTest",value:function(){this._jumpTo("failingTest")}},{key:"jumpToErrorSource",value:function(){this._jumpTo("errorSource")}},{key:"showSideBySideDiff",value:function(){if(this._session){var a=q.activeTextEditor,b=a&&this._getDocumentFilePath(a.document),e=c._activeLine();this._session.requestError({file:b,line:e,type:"failingTest"},function(a){var b;a&&a.error&&(a.error.expected||a.error.actual)&&(b=l.commands).executeCommand.apply(b,["vscode.diff"].concat(d(o.diffCommandArguments(a.error.expected,a.error.actual))))})}}},{key:"showLineTests",value:function(){var a=this;if(this._session){var b=q.activeTextEditor,d=b&&this._getDocumentFilePath(b.document),e=c._activeLine();d&&e&&this._session.openedDocuments[d]&&this._session.requestLineReport({file:d,line:e},function(b){a._lineTestsOutput.show(),c._outputTestResults(a._lineTestsOutput,b.report.tests&&b.report.tests.length?b.report:"Line is not covered or covered not by tests",!0)})}}},{key:"start",value:function(){var a=this;if(this.stop(),!this._activeProjectRoot())return void q.showWarningMessage("Please open some folder/project before starting wallaby.js.");if(!this._configPath())return void c._notifyHowToSelectConfig(this,function(){return a.start()});p.saveAll(!1),this._consoleOutputChannel.clear(),c._checkConfigurationSettings(),this._updateConfigurationFromSettings();var b=this._session=new a._Session;b.disposables=new m,b.filesToTrack=Object.create(null),b.openedDocuments=Object.create(null),b.projectCachePath=i.join(this._packagePath,"projects",c._hash(this._configPath())),b.start({localRoot:this._activeProjectRoot(),projectPath:b.projectCachePath,configPath:this._configPath(),phantomPath:this._phantomPath,client:"VSCode",lkp:this._lkp}),b.on("started",function(b){a._started=!0,delete a._starting,a._consoleOutputChannel.appendLine(o.markupText("message","[Info]")+" Started Wallaby.js Core v"+b.version),a.emit("started",b)}),b.on("stopped",function(b){a.stop(),b.deactivate&&a._forceDeactivate()}),b.on("expiredLicense",function(){delete a._state.onFirstStart}),b.on("notification",function(b){return a.emit("notification",b)}),b.on("busy",function(){a._state.onFirstStart&&(a._state.onFirstStart(),delete a._state.onFirstStart),a.emit("busy")}),b.on("stats",function(b){return a.emit("stats",b)}),b.on("filesToTrack",function(c){return a.emit("filesToTrack",b,c)}),b.on("live",function(c){return a.emit("live",b,c)}),b.on("documentUpdates",function(c){return a.emit("documentUpdates",b,c)}),b.on("navigationRequested",function(b){return a._navigate(b.file,b.loc)}),b.on("consoleError",function(b){return b&&_.each(b.split("\n"),function(b){return b&&a._consoleOutputChannel.appendLine(""+o.markupText("error","[Error] "+b))})}),b.on("consoleLog",function(b){return b&&_.each(b.split("\n"),function(b){return b&&a._consoleOutputChannel.appendLine(o.markupText("message","[Info]")+" "+b)})}),this._starting=!0,this.emit("starting"),a._updateStatus("progress"),b.disposables.add(function(){_.each(q.visibleTextEditors,function(b){_.each(a._coverageDecorationTypes,function(a){return b.setDecorations(a,[])}),a._hideAfterContentDecorationType&&b.setDecorations(a._hideAfterContentDecorationType,[]),a._destroyUncoveredDecorations(b)})})}},{key:"_updateConfigurationFromSettings",value:function(){try{var a=l.workspace.getConfiguration();if(a){this._suppressExpirationNotifications=a.get("wallaby.suppressExpirationNotifications",!1),this._failingTestsOutput&&this._failingTestsOutput.setContentLimit(a.get("wallaby.outputContentSize",0));var b=a.get("wallaby.node","");b?process.env.WALLABY_NODE=b:delete process.env.WALLABY_NODE}}catch(c){}}},{key:"stop",value:function(){var a=this._session;delete this._started,delete this._starting,delete this._session,delete this._stats,a&&(a.disposables&&a.disposables.dispose(),a.stop(),delete a.filesToTrack,delete a.openedDocuments,delete a.disposables,this.emit("stopped"),this._update&&(this._update(),delete this._update),this._consoleOutputChannel.appendLine(o.markupText("message","[Info]")+" Wallaby.js stopped"))}},{key:"toggleUncovered",value:function(){var a=q.activeTextEditor;if(a){var b=!!a._wallabyUncoveredDisplayed;this._destroyUncoveredDecorations(a),b||this._showUncovered(a)}}},{key:"_destroyUncoveredDecorations",value:function(a){a&&(a.setDecorations(this._uncoveredRegionDecorationType,[]),delete a._wallabyUncoveredDisplayed)}},{key:"showLicense",value:function(){var a=this,b="";try{b=k.readFileSync(a._lkp).toString()}catch(c){}q.showInputBox({value:b.length>100?b:"",prompt:"Enter your wallaby.js license key"}).then(function(c){if(!_.isUndefined(c)){var d=b,e=c||"",f=!!a._parseLicenseKey(d),g=a._parseLicenseKey(e),h=!!g,i=!1;if(h||!e&&f)try{k.writeFileSync(a._lkp,e),i=h}catch(j){q.showErrorMessage("Unable to save license key: "+j.message),i=!1}else q.showWarningMessage("The entered license key is not a valid wallaby.js license key");i&&(q.showInformationMessage("Wallaby.js is licensed to: "+g.licensee+". Free upgrades until: "+g.expiration),a.stop())}})}},{key:"_parseLicenseKey",value:function(a){var b=this;if(_.isString(a))try{var c=b._utils.parseKey(a);if(c.licenseeName&&c.expirationDateString&&(~c.licensedProduct.indexOf("(Freedom)")||~c.licensedProduct.indexOf("(VS Code)")))return{licensee:c.licenseeName,expiration:c.expirationDateStringFormatted||c.expirationDateString}}catch(d){return void 0}}},{key:"_updateAvailable",value:function(a){this._started?this._update=a:a()}},{key:"_showUncovered",value:function(a,b){var c=this;if(this._session){var d=a&&this._getDocumentFilePath(a.document);d&&this._session.openedDocuments[d]&&this._session.requestUncoveredRegions({file:d,line:b},function(b){return c._highlightUncovered(a,b.ranges);
})}}},{key:"_highlightUncovered",value:function(a,b){a._wallabyUncoveredDisplayed=!0,a.setDecorations(this._uncoveredRegionDecorationType,_.map(b,function(a){return new l.Range(a[0]-1,a[1],a[2]-1,a[3])}))}},{key:"_jumpTo",value:function(a){var b=this;if(this._session){var d=q.activeTextEditor,e=d&&this._getDocumentFilePath(d.document),f=c._activeLine();this._session.requestLocation({file:e,line:f,type:a},function(a){return b._navigate(a.file,a.loc)})}}},{key:"_runTests",value:function(a,b){if(this._session){var d=void 0,e=void 0;if(b&&(_.isNumber(b)?d=b:(e=b.file,d=b.loc&&parseInt((b.loc+"").split(":")[0],10))),!e){var f=q.activeTextEditor;e=f&&this._getDocumentFilePath(f.document)}d||(d="line"===a&&c._activeLine()),this._session.runTests({file:"project"!==a&&e,line:d})}}},{key:"_execute",value:function(a){return a&&a.command?"function"==typeof a.command?a.command(a):~a.command.indexOf("wallaby.")?l.commands.executeCommand(a.command):this[a.command]():void 0}},{key:"_getDocumentFilePath",value:function(a){return a.uri&&a.uri.fsPath&&this._relativeNormalizedFilePath(a.uri.fsPath)}},{key:"_observeDocuments",value:function(a){var b=this;a.isDisposed()||(a.disposables.add(p.onDidChangeTextDocument(function(c){return b._processDocumentContentChange(a,c.document,c.contentChanges)})),this._processOpenedEditors(a),a.disposables.add(q.onDidChangeActiveTextEditor(function(c){c&&(a.activeEditor===c&&(a.filesWithSameEditorReActivated||(a.filesWithSameEditorReActivated=Object.create(null)),a.filesWithSameEditorReActivated[b._getDocumentFilePath(c.document)]=!0),a.activeEditor=c),b._processOpenedEditors(a)})),a.disposables.add(function(){delete a.activeEditor}),a.disposables.add(q.onDidChangeTextEditorSelection(function(){return b._displayInlineMessageInActiveEditor(a)})))}},{key:"_displayInlineMessageInActiveEditor",value:function(a){var b=this;if(a.isDisposed())return b._updateStatusExtension();var d=c._activeLine();if(!d)return b._updateStatusExtension();var e=q.activeTextEditor;if(!e)return b._updateStatusExtension();var f=b._getDocumentFilePath(e.document);if(f){var g=a.openedDocuments[f];if(!g)return b._updateStatusExtension();var h=g.messagesByLine[d];return h?void b._updateStatusExtension(h):b._updateStatusExtension()}}},{key:"_processOpenedEditors",value:function(a){var b=this;if(!a.isDisposed()){var c=_.reduce(q.visibleTextEditors,function(c,d){if(d){var e=b._getDocumentFilePath(d.document);if(e&&a.filesToTrack[e]){var f=c[e];f||(f=c[e]=Object.create(null)),f[d._id]=!0}}return c},{});_.each(c,function(b,c){var d=_.keys(b).length,e=a.openedDocuments[c],f=d;if(e?(f=d-e.editorCount,0!==f&&(e.editorCount=d)):e=a.openedDocuments[c]={changes:[],path:c,editorCount:f},0!==f)for(var g=f>0?function(){return a.fileOpenedInEditor(c)}:function(){return a.fileClosedInEditor(c)},h=0,i=Math.abs(f);i>h;h++)g();else(!_.isEqual(e.editors,b)||a.filesWithSameEditorReActivated&&a.filesWithSameEditorReActivated[c])&&(a.fileClosedInEditor(c),a.fileOpenedInEditor(c));e.editors=b}),_.each(a.openedDocuments,function(b,d){if(!c[d]){for(var e=0,f=b.editorCount;f>e;e++)a.fileClosedInEditor(d);delete a.openedDocuments[d]}}),delete a.filesWithSameEditorReActivated}}},{key:"_processDocumentContentChange",value:function(a,b,c){if(!(a.isDisposed()||b&&b.uri&&b.uri.scheme&&"file"!==b.uri.scheme)){var d=this._getDocumentFilePath(b),e=a.openedDocuments[d];e&&(e.changes=e.changes.concat(c),this._hideMessagesForChangedRanges(e.changes),this._onceDocumentStopsChanging(a,e,b))}}},{key:"_onceDocumentStopsChanging",value:function(a,b,c){var d=this;!a.isDisposed()&&b.changes.length&&(clearTimeout(d._statusUpdateTimeout),d._statusUpdateTimeout=setTimeout(function(){return d._updateStatus("progress")},r),a.fileChangedInEditor(b.path,c.getText(),{start:_.chain(b.changes).map(function(a){return a.range.start.line}).min().value()+1,end:_.chain(b.changes).map(function(a){return a.range.end.line}).max().value()+1}),b.changes=[],this._destroyUncoveredDecorations(q.activeTextEditor))}},{key:"_updateStatus",value:function(a){var b=this;clearTimeout(this._statusUpdateTimeout),a||(a=_.isString(this._stats)?"failing":this._stats?this._stats.failingNumber||this._stats.errors.length?"failing":"passing":void 0),a&&("progress"===a?this._statusBar.displayProgress():(this._statusBar.stopProgress(),_.isString(this._stats)?b._statusBar.setMainText("✗                "):b._statusBar.setMainText("✗ "+_.pad(this._stats.failingNumber||0,3," ","right")+(" ✔ "+_.pad(this._stats.totalNumber-this._stats.failingNumber||0,5," ","right"))),b._statusBar.updateText()),this._statusBar.show())}},{key:"_updateStatusExtension",value:function(a){this._statusBar.setExtensionText(a),this._statusBar.updateText()}},{key:"_continueTrial",value:function(){this._session&&this._session.continueTrial()}},{key:"_openPurchasePage",value:function(){try{a("openurl").open("https://wallabyjs.com/purchase")}catch(b){}}},{key:"_removeStatus",value:function(){this._statusBar.hide()}},{key:"_updateDocuments",value:function(a,b){if(!a.isDisposed()){var d=this;_.each(q.visibleTextEditors,function(e){var f=d._getDocumentFilePath(e.document),g=a.openedDocuments[f]||{};g.messagesByLine=Object.create(null);var h=b[f];if(h&&h.lines){var i={1:[],2:[],3:[],4:[],5:[]};_.each(h.lines,function(a){var b={range:new l.Range(a.num-1,0,a.num-1,1e3)},e=a.err||a.log,f=a.longLog||e;f&&(b.hoverMessage=l.MarkdownString?new l.MarkdownString("```\n"+f+"\n```"):f),i[a.state].push(b),e&&(g.messagesByLine[a.num]=e,d._hideAfterContentDecorationType&&(b.renderOptions={after:{contentText:"  "+c._escapeInlineMessage(e)}}))}),_.each(i,function(a,b){return e.setDecorations(d._coverageDecorationTypes[b],a)}),d._scheduleHiddenMessagesDisplay()}})}}},{key:"_hideMessagesForChangedRanges",value:function(a){this._hideAfterContentDecorationType&&(clearTimeout(this._displayHiddenMessagesTimeout),this._messagesHiddenAt=+new Date,q.activeTextEditor.setDecorations(this._hideAfterContentDecorationType,a.map(function(a){return{range:new l.Range(a.range.start.line,0,a.range.end.line,1e3)}})))}},{key:"_scheduleHiddenMessagesDisplay",value:function(){if(this._hideAfterContentDecorationType){var a=this;clearTimeout(this._displayHiddenMessagesTimeout);var b=this._messagesHiddenAt?+new Date-this._messagesHiddenAt:400;this._displayHiddenMessagesTimeout=setTimeout(function(){try{_.each(q.visibleTextEditors,function(b){return b.setDecorations(a._hideAfterContentDecorationType,[])})}catch(b){}},Math.max(0,500-b))}}},{key:"_navigate",value:function(a,b){if(a){var c=this._absoluteFilePath(a),d=void 0,e=void 0;_.isNumber(b)?d=b:_.isArray(b)?(d=b[0],e=b[1]):_.isString(b)&&(b=b.split(":"),d=b[0]&&parseInt(b[0],10),e=b[1]&&parseInt(b[1],10)),_.isNumber(d)?d-=1:d=0,_.isNumber(e)||(e=0),p.openTextDocument(c).then(function(a){return q.showTextDocument(a)}).then(function(a){var b=new l.Position(d,e);a.revealRange(new l.Range(b,b)),a.selection=new l.Selection(b,b)})}}},{key:"_relativeConfigPath",value:function(){return this._configPath()&&i.relative(this._activeProjectRoot(),this._configPath())}},{key:"_absoluteFilePath",value:function(a){return this._configFolderPath()&&i.resolve(this._configFolderPath(),a)}},{key:"_relativeNormalizedFilePath",value:function(a,b){return(b||this._configFolderPath())&&this._utils.normalizePath(i.relative(b||this._configFolderPath(),a))}},{key:"_configByConvention",value:function(){var a=this;if(this._activeProjectRoot())return _.chain(["wallaby.js","wallaby.conf.js",".wallaby.js",".wallaby.conf.js","wallaby.json",".wallaby.json"]).map(function(b){return i.join(a._activeProjectRoot(),b)}).find(function(a){return k.existsSync(a)}).value()}}],[{key:"_checkConfigurationSettings",value:function(){try{var a=l.workspace.getConfiguration();a&&!a.get("editor.glyphMargin",!0)&&q.showWarningMessage("Wallaby.js will not display coverage indicators because the `editor.glyphMargin` setting is set to `false`.")}catch(b){}}},{key:"_activeLine",value:function(){var a=q.activeTextEditor;return a&&a.selection&&a.selection.active&&a.selection.active.line+1}},{key:"_notifyHowToSelectConfig",value:function(a,b){return q.showWarningMessage("Please select wallaby.js configuration file.",{title:"Select Wallaby.js Config File",command:function(){return a.selectConfigFile(b)}}).then(a._executeCommand)}},{key:"_escapeInlineMessage",value:function(a){return c._cssEscape(a).replace(/'/g,'"')}},{key:"_hash",value:function(a){return j.createHash("md5").update(a).digest("hex").substr(0,16)}},{key:"_outputTestResults",value:function(a,b,c){var d=void 0,e=a.lines();a.build(b);var f=a.lines();if(d=c||f.length!==e.length,!d)for(var g=0,h=f.length;h>g;g++)if(a.areDifferent(f[g],e[g])){d=!0;break}d&&a.render()}},{key:"_cssEscape",value:function(a){for(var b,c=String(a),d=c.length,e=-1,f="",g=c.charCodeAt(0);++e<d;)b=c.charCodeAt(e),f+=b>=1&&31>=b||127==b||0==e&&b>=48&&57>=b||1==e&&b>=48&&57>=b&&45==g?"\\"+b.toString(16)+" ":b>=128||45==b||95==b||b>=48&&57>=b||b>=65&&90>=b||b>=97&&122>=b?c.charAt(e):"\\"+c.charAt(e);return f}}]),c}(EventEmitter);b.exports=u},{"./compositeDisposable":3,"./screenshotContentProvider":5,"./testsOutputBuilder":6,crypto:void 0,"fs-extra":void 0,openurl:void 0,path:void 0,vscode:void 0}],5:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("vscode"),g=function(){function a(b){d(this,a),this._onDidChange=new f.EventEmitter,this._screenshotUriResolver=b,this._screenShotUri=f.Uri.parse("wallaby-screenshot://authority/wallaby-screenshot")}return e(a,[{key:"provideTextDocumentContent",value:function(){var a=void 0;try{a=this._screenshotUriResolver()}catch(b){return""}return'<!DOCTYPE html>\n            <html>\n            <head>\n            </head>\n            <body>\n                <img src="'+a.toString()+"?ts="+ +new Date+'" />\n            </body>\n            </html>'}},{key:"update",value:function(){this._onDidChange.fire(this._screenShotUri)}},{key:"onDidChange",get:function(){return this._onDidChange.event}}]),a}();b.exports=g},{vscode:void 0}],6:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("vscode"),g={text:"",link:Array(2).join("​"),error:Array(3).join("​"),duration:Array(4).join("​"),suite:Array(5).join("​"),message:Array(6).join("​"),diffIns:Array(2).join("‌⁠"),diffDel:Array(2).join("‍"),tmpDiffInsOpen:"wsDiffIns",tmpDiffInsClose:"weDiffIns",tmpDiffDelOpen:"wsDiffDel",tmpDiffDelClose:"weDiffDel",linkNoStack:Array(2).join("​")},h="All tests covering the line of code:",i=" failing tests, ",j=function(){function a(b,c,e,g,j,k,l,m){d(this,a);var n=this;this._lines=[],this._links=[],this._lineAndColumnLinks=j,this._contentLimit=204800,this._channel=b,this._absolutePathResolver=c,this._failingTestsOutput=k,this._dmp=e,this.render=_.debounce(_.bind(this.render,this),300),this._timeEnd=" ms]​",this._sideBySideDiffSupported=m,f.languages.registerDocumentLinkProvider&&g.add(f.languages.registerDocumentLinkProvider(l,{provideDocumentLinks:function(a){var b=a.lineAt(0);return b&&b.text&&(n._failingTestsOutput&&~b.text.indexOf(i)||!n._failingTestsOutput&&~b.text.indexOf(h))?n._links:[]}}))}return e(a,[{key:"build",value:function(a){var b=this;b._lines=[],b._links=[];var c=_.isString(a);c?b._appendLine(this._failingTestsOutput?"error":"message",0,a,this._failingTestsOutput&&"Error"):_.isObject(a)&&(this._failingTestsOutput?b._appendLine("message",0,a.failingNumber+i+(a.totalNumber-a.failingNumber)+" passing"+(a.errors&&a.errors.length?"\n":"")):b._appendLine("message",0,h,"Info"),_.each(a.errors,function(a){return b._outputError(a.message,a.stack,a.expected,a.actual,a.snapshot)}),_.each(a.tests,function(a){return b._outputTest(a)}))}},{key:"lines",value:function(){return this._lines}},{key:"render",value:function(){var a=this;a._channel.clear();for(var b="",c=0,d=this._lines.length;d>c;c++){var e=this._lines[c];if(b+=e+"\n",b.length>this._contentLimit){b+="\n--- output truncated to "+this._contentLimit+' bytes (use the "wallaby.outputContentSize" user setting to change the bytes limit) ---\n';break}}a._channel.append(b)}},{key:"show",value:function(){this._channel.show(f.ViewColumn.Two)}},{key:"areDifferent",value:function(a,b){return!(a===b||~a.indexOf(this._timeEnd)&&~b.indexOf(this._timeEnd)&&a.substr(0,a.lastIndexOf("["))===b.substr(0,b.lastIndexOf("[")))}},{key:"setContentLimit",value:function(a){a&&(this._contentLimit=a)}},{key:"createDiffMarkdown",value:function(a,b,c,d){var e=[];return this._sideBySideDiffOutputLink(a,b,c,d,0,e),e.push("```wallaby-output"),this._diffOutput(a,b,0,e),e.push("```"),e.join("\n")}},{key:"_sideBySideDiffOutputLink",value:function(b,c,d,e,g,h){var i=this;b=b||"",c=c||"",g=g||0,this._sideBySideDiffSupported&&!function(){var j="\nShow side-by-side diff",k=f.Uri.parse("command:vscode.diff?"+JSON.stringify(a.diffCommandArguments(b,c))),l="Update snapshot",m=f.Uri.parse("command:wallaby.updateTestSnapshots?"+JSON.stringify(e)),n=d&&e;h?f.MarkdownString&&(j="[Show side-by-side diff]("+k+")",n&&(j+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["+l+"]("+m+")"),i._appendLine("linkNoStack",g,j,void 0,void 0,void 0,h)):i._appendLine("linkNoStack",g,j+(n?"  "+l:""),void 0,void 0,function(a,b){var c=i._lines.length;i._links.push({range:new f.Range(c,b,c,b+j.length-1),target:k}),n&&i._links.push({range:new f.Range(c,b+j.length+1,c,b+j.length+l.length+1),target:m})})}()}},{key:"_diffOutput",value:function(a,b,c,d){a=a||"",b=b||"",c=c||0;var e=(d?"":"\n")+this._dmp[this._dmp.diff_prettyCompactHtml?"diff_prettyCompactHtml":"diff_prettyHtml"](this._dmp.diff_wordMode(a,b)).replace(/&para;<br>/g,"\n").replace(/<br>/g,"\n").replace(/<span class="dots">\.\.\.<\/span>/g,g.duration+"..."+g.duration).replace(/<\/?span[^>]*>/g,"").replace(/<ins[^>]*>/g,g.tmpDiffInsOpen).replace(/<del[^>]*>/g,g.tmpDiffDelOpen).replace(/<\/ins[^>]*>/g,g.tmpDiffInsClose).replace(/<\/del[^>]*>/g,g.tmpDiffDelClose).replace(/style="background:#e6ffe6;"/g,"").replace(/style="background:#ffe6e6;"/g,"").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&gt;/g,">"),f=0,h=0;this._appendLine("none",c,e,void 0,void 0,function(a){if(!a)return a;f>0&&(a=g.diffIns+a),h>0&&(a=g.diffDel+a);var b=(a.match(new RegExp(g.tmpDiffInsOpen,"g"))||[]).length,c=(a.match(new RegExp(g.tmpDiffInsClose,"g"))||[]).length;f+=b-c;var d=(a.match(new RegExp(g.tmpDiffDelOpen,"g"))||[]).length,e=(a.match(new RegExp(g.tmpDiffDelClose,"g"))||[]).length;return h+=d-e,f>0&&(a+=g.diffIns),h>0&&(a+=g.diffDel),a.replace(new RegExp(g.tmpDiffInsOpen,"g"),g.diffIns).replace(new RegExp(g.tmpDiffInsClose,"g"),g.diffIns).replace(new RegExp(g.tmpDiffDelOpen,"g"),g.diffDel).replace(new RegExp(g.tmpDiffDelClose,"g"),g.diffDel)},d)}},{key:"_outputError",value:function(a,b,c,d,e,f){var g=this;f=f||0,this._dmp&&(c||d)&&(this._sideBySideDiffOutputLink(c,d,e,b&&b.length&&b[0],f),this._diffOutput(c,d,f)),this._appendLine("error",f,a),_.each(b,function(a){return g._outputLink(a,f+1)})}},{key:"_outputTest",value:function(a){var b=this,c=1,d=a.path&&_.last(a.path)||"",e=_.initial(a.path||[]).join(" "),h=(""+g.suite+e+" "+d+g.suite).replace(/\r?\n|\r/g," ").replace(/\s\s+/g," "),i=_.isNumber(a.time)?"["+a.time+this._timeEnd:"";b._appendLine("text",c,""),b._appendLine("text",c,h+" "+g.duration+i+g.duration,void 0,void 0,function(c,d){var e=b._lines.length;b._links.push({range:new f.Range(e,d,e,d+h.length),target:f.Uri.parse(f.Uri.file(b._absolutePathResolver(a.file)).toString()+b._location(a.loc))})}),_.each(a.errors,function(a){return b._outputError("\n"+a.message,a.stack,a.expected,a.actual,a.snapshot,c+1)}),a.messages&&a.messages.length&&(b._appendLine("message",c+1,"\nFrom console:"),_.each(a.messages,function(a){return b._appendLine("message",c+2,"\n"+a.text),b._outputLink(a,c+2)}))}},{key:"_outputLink",value:function(a,b){var c=this;if(a.file){var d=a.file+":"+a.loc;this._appendLine("link",b,d,void 0,a.context,function(b,e){var g=c._lines.length;c._links.push({range:new f.Range(g,e,g,e+d.length),target:f.Uri.parse(f.Uri.file(c._absolutePathResolver(a.file)).toString()+c._location(a.loc))})})}}},{key:"_location",value:function(a){var b=void 0,c=void 0;return _.isNumber(a)?b=a:_.isArray(a)?(b=a[0],c=a[1]):_.isString(a)&&(a=a.split(":"),b=a[0]&&parseInt(a[0],10),c=a[1]&&parseInt(a[1],10)),"#"+(this._lineAndColumnLinks&&_.isNumber(c)?b+","+(c+1):b)}},{key:"_appendLine",value:function(a,b,c,d,e,f,h){var i=this,j=c.split(/\r\n|\r|\n/);e&&e.replace&&(e=e.replace(/\r\n\s*/g," ").replace(/\n\s*/g," "));var k=g[a]||"";_.each(j,function(c){var g=(d?"["+d+"] ":"")+_.pad("",2*b,"   ")+("link"===a?"at "+(e?e+" ":""):"")+k,j=g+c+k;if(f){var l=f(j,g.length);l&&(j=l)}(h||i._lines).push(j)})}}],[{key:"markupText",value:function(a,b){var c=g[a]||"";return""+c+b+c}},{key:"diffCommandArguments",value:function(a,b){return[f.Uri.parse("wallaby-diff:data?"+new Buffer(a).toString("base64")),f.Uri.parse("wallaby-diff:data?"+new Buffer(b).toString("base64")),"Expected vs Actual"]}}]),a}();b.exports=j},{vscode:void 0}],7:[function(a,b,c){b.exports={name:"wallaby-vscode",displayName:"Wallaby.js",description:"Integrated Continuous Testing Tool for JavaScript.",version:"1.0.74",author:"Wallaby.js",homepage:"http://wallabyjs.com",bugs:{url:"https://github.com/wallabyjs/public/issues"},publisher:"WallabyJs",engines:{vscode:"0.10.x"},keywords:["testing","runner","unittest","JavaScript","TypeScript"],categories:["Other"],activationEvents:["*"],main:"./index",icon:"images/logo.png",galleryBanner:{color:"#ffffff",theme:"light"},contributes:{commands:[{command:"wallaby.start",title:"Wallaby.js: Start"},{command:"wallaby.stop",title:"Wallaby.js: Stop"},{command:"wallaby.showCommandPalette",title:"Wallaby.js: Show Commands"},{command:"wallaby.jumpToFailingTest",title:"Wallaby.js: Jump to Failing Test"},{command:"wallaby.jumpToErrorSource",title:"Wallaby.js: Jump to Error Source"},{command:"wallaby.toggleUncovered",title:"Wallaby.js: Toggle Uncovered Code Regions"},{command:"wallaby.showLineTests",title:"Wallaby.js: Show Line Tests"},{command:"wallaby.showFailingTests",title:"Wallaby.js: Show Failing Tests"},{command:"wallaby.showSideBySideDiff",title:"Wallaby.js: Show Side-by-Side Diff"},{command:"wallaby.runProjectTests",title:"Wallaby.js: Run Project Tests"},{command:"wallaby.runFileTests",title:"Wallaby.js: Run File Tests"},{command:"wallaby.runLineTests",title:"Wallaby.js: Run Line Tests"},{command:"wallaby.updateProjectSnapshots",title:"Wallaby.js: Update Project Snapshots"},{command:"wallaby.updateFileSnapshots",title:"Wallaby.js: Update File Snapshots"},{command:"wallaby.updateTestSnapshots",title:"Wallaby.js: Update Test Snapshots"},{command:"wallaby.openWallabyApp",title:"Wallaby.js: Open Wallaby App"},{command:"wallaby.selectConfigFile",title:"Wallaby.js: Select Configuration File"},{command:"wallaby.showLastScreenshot",title:"Wallaby.js: Show Last Screenshot"},{command:"wallaby.showLicense",title:"Wallaby.js: Manage License Key"}],keybindings:[{command:"wallaby.showCommandPalette",key:"ctrl+shift+=",mac:"cmd+shift+="},{command:"wallaby.start",key:"ctrl+shift+r r",mac:"cmd+shift+r r"},{command:"wallaby.stop",key:"ctrl+shift+r s",mac:"cmd+shift+r s"},{command:"wallaby.runProjectTests",key:"ctrl+shift+r p",mac:"cmd+shift+r p"},{command:"wallaby.showLastScreenshot",key:"ctrl+shift+r h",mac:"cmd+shift+r h"},{command:"wallaby.runLineTests",key:"ctrl+shift+r c",mac:"cmd+shift+r c",when:"editorTextFocus"},{command:"wallaby.runFileTests",key:"ctrl+shift+r f",mac:"cmd+shift+r f",when:"editorTextFocus"},{command:"wallaby.jumpToFailingTest",key:"ctrl+shift+r o",mac:"cmd+shift+r o",when:"editorTextFocus"},{command:"wallaby.jumpToErrorSource",key:"ctrl+shift+r p",mac:"cmd+shift+r p",when:"editorTextFocus"},{command:"wallaby.toggleUncovered",key:"ctrl+shift+r u",mac:"cmd+shift+r u",when:"editorTextFocus"},{command:"wallaby.showFailingTests",key:"ctrl+shift+r t",mac:"cmd+shift+r t"},{command:"wallaby.showLineTests",key:"ctrl+shift+r l",mac:"cmd+shift+r l",when:"editorTextFocus"},{command:"wallaby.showSideBySideDiff",key:"ctrl+shift+r d",mac:"cmd+shift+r d",when:"editorTextFocus"}],languages:[{id:"wallaby-output",mimetypes:["text/x-code-output"]}],grammars:[{language:"wallaby-output",scopeName:"wallaby.output",path:"./wallaby-output.tmLanguage"}]},devDependencies:{lodash:"*",grunt:"*","grunt-babel":"5.0.1","grunt-browserify":"*","grunt-bump":"0.0.16","grunt-contrib-clean":"*","grunt-contrib-compress":"^0.12.0","grunt-contrib-copy":"*","grunt-contrib-uglify":"*",vscode:"0.10.x"},dependencies:{"adm-zip-mit":"0.4.8","fs-extra":"0.26.2",lockfile:"1.0.3",openurl:"1.1.1",q:"1.4.1",request:"2.65.0","tar-stream":"1.3.1","unbzip2-stream":"1.0.8"},__metadata:{id:"6766254a-8e43-4ebc-9b89-e5be39cb5318",publisherDisplayName:"Wallaby.js",publisherId:"9e43bb4e-4318-4e59-b5c2-df1109a963dd"}}},{}]},{},[2]);